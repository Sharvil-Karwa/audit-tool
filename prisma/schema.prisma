// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Audit {
  id         String      @id @default(uuid())
  name       String
  creatorId  String
  equipments Equipment[] @relation("AuditToEquipment")
  observations Observation[] @relation("AuditToObservation")
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

model Department {
  id                  String                @id @default(uuid())
  name                String
  auditId             String
  equipments          Equipment[]           @relation("EquipmentToDepartments")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  DepartmentEquipment DepartmentEquipment[]
}

model Equipment {
  id                  String                @id
  name                String
  location            String
  type                String
  auditId             String
  audit               Audit                 @relation("AuditToEquipment", fields: [auditId], references: [id])
  departments         Department[]          @relation("EquipmentToDepartments")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  DepartmentEquipment DepartmentEquipment[]

  @@index([auditId])
}

model DepartmentEquipment {
  id           String     @id @default(uuid())
  departmentId String
  equipmentId  String
  auditId String
  department   Department @relation(fields: [departmentId], references: [id])
  equipment    Equipment  @relation(fields: [equipmentId], references: [id])
}

model Observation {
  id                  String                @id @default(uuid())
  observation         String
  reference           String
  auditId             String
  audit               Audit                 @relation("AuditToObservation", fields: [auditId], references: [id])
  areas               Area[]                @relation("AreaToObservation")
  AreaObservation     AreaObservation[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt

  @@index([auditId])
}

model Area {
  id                  String                @id @default(uuid())
  area                String
  auditId             String
  observations        Observation[]         @relation("AreaToObservation")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  AreaObservation     AreaObservation[]
}

model AreaObservation {
  id           String     @id @default(uuid())
  observationId String
  areaId  String
  auditId String
  observation Observation @relation(fields: [observationId], references: [id])
  area Area  @relation(fields: [areaId], references: [id])
}